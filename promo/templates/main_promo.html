{% extends 'base.html' %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Mouse+Memoirs&display=swap" rel="stylesheet">
<div>
	<button onclick="showModal()">
		Add Promo
	</button>
</div>
<div>
	<div id="promo_cards"></div>
</div>
<div style="display: none;" id="modal">
	<div id="modal_content">
	  <div> <!--Header-->
		<p>Tambah Promo</p>
	  </div>
	  <div> <!--Body-->
		<form id="formpromo" action="{% url 'promo:add_promo' %}">
		  <div>
			<label for="nama">Nama</label>
			<input type="text" name="nama" id="nama">
		  </div>
		  <div>
			<label for="kode">Kode</label>
			<input type="text" name="kode" id="kode">
		  </div>
		  <div>
			<label for="potongan">Potongan</label>
			<input type="number" step="100" min=0 name="potongan" id="potongan">
		  </div>
		  <div>
			<label for="tanggal_akhir_berlaku">Tanggal Akhir Berlaku</label>
			<input type="date"name="tanggal_akhir_berlaku" id="tanggal_akhir_berlaku">
		  </div>
		  <div>
			<label for="stock">Stock</label>
			<input type="number" step="1" min=0 name="stock" id="stock">
		  </div>
		  <div>
			<label for="deskripsi">Deskripsi</label>
			<textarea name="deskripsi" id="deskripsi"></textarea>
		  </div>
		</form>
	  </div>
	  <div> <!--footer-->
		<button type="button" id="cancel" onclick="hideModal()">Cancel</button>
		<button type="submit" id="submitItem" form="formpromo">Save</button>
	  </div>
	</div>  
</div>
  



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
async function get_promo() {
	return fetch("{% url 'promo:show_json' %}").then((res) => res.json());
}

async function refreshPromo() {
    $("#promo_cards").html("");
    const promos = await get_promo();
    let htmlString = "";
    
    if (promos.length === 0) {
        htmlString = `Belum ada promo`;
    } else {
        promos.forEach((promo) => {
            htmlString += `
            <a href="view_promo_admin/${promo.pk}" style="color:black">
                <div style="background-color: #FFF0F0; display: inline-flex; width: 30vw; height: 12vw; border-radius: 2vh; font-family: 'Mouse Memoirs';">
                    <div style="flex: 3; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; font-style: normal; font-weight: 400; line-height: normal; width: 100%; margin-bottom: 1vw;">
                        <div style="font-size: 3vw; flex: 3; display: flex; justify-content: center; align-items: center; width: 100%; text-decoration: underline;">${promo.fields.nama}</div>
                        <div style="font-size: 2vw; flex: 1; display: flex; justify-content: center; align-items: center; width: 100%; margin-bottom: 0.5vw;">kode: ${promo.fields.kode}</div>
                        <div style="font-size: 2vw; flex: 1; display: flex; justify-content: center; align-items: center; width: 100%; margin-bottom: 0.5vw;">Valid hingga ${promo.fields.tanggal_akhir_berlaku}</div>
                    </div>`;

            const potonganValue = promo.fields.potongan / 1000;
            let bgColor, fontSize = '4vw';

            if (potonganValue <= 100) {
                bgColor = "#4E9B00";
            } else if (potonganValue <= 1000) {
                bgColor = "#FF6E20"; 
            } else {
                bgColor = "#9812FF";
            }

            htmlString += `
                    <div style="flex: 2; background-color: ${bgColor}; border-bottom-right-radius: 2vh; border-top-right-radius: 2vh; width: 100%; color: white; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: ${fontSize};">
                        ${potonganValue.toFixed(0)}k
                    </div>
                </div>
            </a>`;
        });
    }

    $("#promo_cards").html(htmlString);
}

refreshPromo();

function showModal() {
	$("#modal").css("display","");
}

function hideModal() {
	$("#modal").css("display","none")
}

//https://gawibowo.com/submit-form-dengan-ajax-menggunakan-jquery.htm
$('#formpromo').submit(function() {
		$.ajax({
			type: 'POST',
			url: $(this).attr('action'),
			data: $(this).serialize(),
			success: function(data) {
				refreshPromo();
				document.getElementById("formpromo").reset();
				hideModal();
			}
		})
		return false;
	})


</script>



{% endblock content %} 	